---
import BaseLayout from "../layouts/BaseLayout.astro";
import { onPageLoad } from "astro/dist/core.mjs";
import { createState } from "astro/dist/astro.mjs";
import '../styles/cooking.css';
---

<BaseLayout sideBarActiveItemID="cooking">
  <div class="pb-12 mt-5">
    <div class="text-xl py-1"><b>My Journey With Cooking</b></div>
    <div class="py-2">
      <text class="text-lg">
        I got into cooking in 2022 and really enjoyed learning the techniques
      </text>
    </div>
    <div class="py-2">
      <text class="text-lg">
        Hey, welcome to my website! Iâ€™m a data engineer at Acorns and located in the D.C. area. 
      </text>
    </div>  
    <div class="py-2">
      <text class="text-lg">
        Don't let my poor photography fool you
      </text>
    </div>
    <div class="divider my-0"></div>
  </div>
  <div>
    <div class="text-3xl w-full font-bold mb-5 mt-10">Some of My Dishes</div>
    <div class="gallery" id="astro-gallery">
      <!-- Images and names will be added here dynamically -->
    </div>
  </div>
</BaseLayout>

<script>
  // Define global state to track whether images have been loaded
  const { getState, setState, subscribe } = createState({
    imagesLoaded: false
  });

  // JavaScript for preloading images and dynamically adding images and names
  const images = [
    { src: '/food_1.webp', name: 'Astro Photo 1' },
    { src: '/food_1.webp', name: 'Astro Photo 2' },
    { src: '/food_1.webp', name: 'Astro Photo 3' },
    { src: '/food_1.webp', name: 'Astro Photo 4' },
    { src: '/food_1.webp', name: 'Astro Photo 5' },
    { src: '/food_1.webp', name: 'Astro Photo 6' },
  ];

  // Preload images
  const preloadImages = () => {
    for (const image of images) {
      const img = new Image();
      img.src = image.src;
    }
  };

  // Add images and names dynamically
  const addImages = () => {
    const gallery = document.getElementById('astro-gallery');
    let currentRow;

    images.forEach((image, index) => {
      if (index % 3 === 0) {
        currentRow = document.createElement('div');
        currentRow.classList.add('gallery-row');
        gallery.appendChild(currentRow);
      }

      const imageContainer = document.createElement('div');
      imageContainer.classList.add('image-container');

      const img = document.createElement('img');
      img.src = image.src;
      img.alt = image.name;

      const name = document.createElement('div');
      name.textContent = image.name;
      name.classList.add('image-caption');

      imageContainer.appendChild(img);
      imageContainer.appendChild(name);
      currentRow.appendChild(imageContainer);
    });

    // Update global state to indicate images are loaded
    setState({ imagesLoaded: true });
  };

  // Subscribe to changes in global state
  subscribe((state) => {
    // When imagesLoaded state changes to true, add images
    if (state.imagesLoaded) {
      addImages();
    }
  });

  // Preload images when the page initially loads
  preloadImages();

  onPageLoad(() => {
    // If the images are not yet loaded (e.g., navigating from the sidebar), add them
    if (!getState().imagesLoaded) {
      addImages();
    }
  });
</script>
